<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DM Teacher Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .completed { background-color: #d4edda !important; border-color: #c3e6cb !important; }
        .activity-item { transition: all 0.3s ease; cursor: pointer; }
        .activity-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .progress-bar { background: linear-gradient(90deg, #4ade80 0%, #22c55e 100%); transition: width 0.5s ease; }
        .save-status { position: fixed; top: 20px; right: 20px; z-index: 1000; padding: 12px 24px; border-radius: 8px; font-weight: 600; }
        .save-status.saving { background: #fbbf24; color: #92400e; }
        .save-status.success { background: #34d399; color: #065f46; }
        .save-status.error { background: #f87171; color: #991b1b; }
        .week-header { cursor: pointer; user-select: none; }
        .week-content { transition: max-height 0.3s ease, opacity 0.3s ease; overflow: hidden; }
        .week-collapsed { max-height: 0; opacity: 0; }
        .week-expanded { max-height: 2000px; opacity: 1; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Activity data structure
        const activities = {
            week1: {
                title: "Week 1: Foundation & Setup",
                collapsed: false,
                days: {
                    day1: {
                        title: "Day 1: Getting Started",
                        activities: {
                            "W1D1A1O": { title: "Watch Overview Video", type: "video", link: "[VIDEO_LINK]" },
                            "W1D1A2R": { title: "Read Getting Started Guide", type: "reading", link: "[READING_LINK]" },
                            "W1D1A3Q": { title: "Complete Setup Quiz", type: "quiz", link: "[QUIZ_LINK]" },
                            "W1D1A4P": { title: "Practice Exercise 1", type: "practice", link: "[PRACTICE_LINK]" },
                            "W1D1A5A": { title: "Submit Assignment 1", type: "assignment", link: "[ASSIGNMENT_LINK]" },
                            "W1D1A6O": { title: "Watch Supplementary Video", type: "video", link: "[VIDEO_LINK]" },
                            "W1D1A7R": { title: "Review Materials", type: "reading", link: "[READING_LINK]" }
                        }
                    },
                    day2: {
                        title: "Day 2: Basic Concepts",
                        activities: {
                            "W1D2A1O": { title: "Morning Briefing Video", type: "video", link: "[VIDEO_LINK]" },
                            "W1D2A2R": { title: "Core Concepts Reading", type: "reading", link: "[READING_LINK]" },
                            "W1D2A3Q": { title: "Knowledge Check Quiz", type: "quiz", link: "[QUIZ_LINK]" },
                            "W1D2A4P": { title: "Hands-on Practice", type: "practice", link: "[PRACTICE_LINK]" },
                            "W1D2A5A": { title: "Daily Assignment", type: "assignment", link: "[ASSIGNMENT_LINK]" },
                            "W1D2A6O": { title: "Review Session Video", type: "video", link: "[VIDEO_LINK]" },
                            "W1D2A7R": { title: "Additional Resources", type: "reading", link: "[READING_LINK]" }
                        }
                    },
                    day3: {
                        title: "Day 3: Application",
                        activities: {
                            "W1D3A1O": { title: "Application Demo Video", type: "video", link: "[VIDEO_LINK]" },
                            "W1D3A2R": { title: "Best Practices Guide", type: "reading", link: "[READING_LINK]" },
                            "W1D3A3Q": { title: "Application Quiz", type: "quiz", link: "[QUIZ_LINK]" },
                            "W1D3A4P": { title: "Real-world Practice", type: "practice", link: "[PRACTICE_LINK]" },
                            "W1D3A5A": { title: "Project Assignment", type: "assignment", link: "[ASSIGNMENT_LINK]" },
                            "W1D3A6O": { title: "Expert Interview Video", type: "video", link: "[VIDEO_LINK]" },
                            "W1D3A7R": { title: "Case Study Reading", type: "reading", link: "[READING_LINK]" }
                        }
                    },
                    day4: {
                        title: "Day 4: Advanced Topics",
                        activities: {
                            "W1D4A1O": { title: "Advanced Concepts Video", type: "video", link: "[VIDEO_LINK]" },
                            "W1D4A2R": { title: "Technical Documentation", type: "reading", link: "[READING_LINK]" },
                            "W1D4A3Q": { title: "Advanced Quiz", type: "quiz", link: "[QUIZ_LINK]" },
                            "W1D4A4P": { title: "Complex Practice Exercise", type: "practice", link: "[PRACTICE_LINK]" },
                            "W1D4A5A": { title: "Advanced Assignment", type: "assignment", link: "[ASSIGNMENT_LINK]" },
                            "W1D4A6O": { title: "Troubleshooting Video", type: "video", link: "[VIDEO_LINK]" },
                            "W1D4A7R": { title: "Reference Materials", type: "reading", link: "[READING_LINK]" }
                        }
                    }
                }
            },
            week2: {
                title: "Week 2: Skill Development",
                collapsed: false,
                days: {
                    day1: {
                        title: "Day 1: Building Skills",
                        activities: {
                            "W2D1A1O": { title: "Skill Development Video", type: "video", link: "[VIDEO_LINK]" },
                            "W2D1A2R": { title: "Methodology Reading", type: "reading", link: "[READING_LINK]" },
                            "W2D1A3Q": { title: "Skills Assessment Quiz", type: "quiz", link: "[QUIZ_LINK]" },
                            "W2D1A4P": { title: "Skill Practice Session", type: "practice", link: "[PRACTICE_LINK]" },
                            "W2D1A5A": { title: "Skill Demonstration", type: "assignment", link: "[ASSIGNMENT_LINK]" },
                            "W2D1A6O": { title: "Peer Learning Video", type: "video", link: "[VIDEO_LINK]" },
                            "W2D1A7R": { title: "Strategy Guide", type: "reading", link: "[READING_LINK]" }
                        }
                    },
                    day2: {
                        title: "Day 2: Practical Application",
                        activities: {
                            "W2D2A1O": { title: "Practical Demo Video", type: "video", link: "[VIDEO_LINK]" },
                            "W2D2A2R": { title: "Implementation Guide", type: "reading", link: "[READING_LINK]" },
                            "W2D2A3Q": { title: "Implementation Quiz", type: "quiz", link: "[QUIZ_LINK]" },
                            "W2D2A4P": { title: "Guided Practice", type: "practice", link: "[PRACTICE_LINK]" },
                            "W2D2A5A": { title: "Implementation Project", type: "assignment", link: "[ASSIGNMENT_LINK]" },
                            "W2D2A6O": { title: "Success Stories Video", type: "video", link: "[VIDEO_LINK]" },
                            "W2D2A7R": { title: "Common Pitfalls Guide", type: "reading", link: "[READING_LINK]" }
                        }
                    },
                    day3: {
                        title: "Day 3: Refinement",
                        activities: {
                            "W2D3A1O": { title: "Refinement Techniques Video", type: "video", link: "[VIDEO_LINK]" },
                            "W2D3A2R": { title: "Quality Standards Reading", type: "reading", link: "[READING_LINK]" },
                            "W2D3A3Q": { title: "Quality Check Quiz", type: "quiz", link: "[QUIZ_LINK]" },
                            "W2D3A4P": { title: "Refinement Practice", type: "practice", link: "[PRACTICE_LINK]" },
                            "W2D3A5A": { title: "Quality Improvement Task", type: "assignment", link: "[ASSIGNMENT_LINK]" },
                            "W2D3A6O": { title: "Expert Tips Video", type: "video", link: "[VIDEO_LINK]" },
                            "W2D3A7R": { title: "Advanced Techniques", type: "reading", link: "[READING_LINK]" }
                        }
                    },
                    day4: {
                        title: "Day 4: Mastery Check",
                        activities: {
                            "W2D4A1O": { title: "Mastery Overview Video", type: "video", link: "[VIDEO_LINK]" },
                            "W2D4A2R": { title: "Mastery Criteria Reading", type: "reading", link: "[READING_LINK]" },
                            "W2D4A3Q": { title: "Comprehensive Quiz", type: "quiz", link: "[QUIZ_LINK]" },
                            "W2D4A4P": { title: "Mastery Challenge", type: "practice", link: "[PRACTICE_LINK]" },
                            "W2D4A5A": { title: "Portfolio Submission", type: "assignment", link: "[ASSIGNMENT_LINK]" },
                            "W2D4A6O": { title: "Reflection Video", type: "video", link: "[VIDEO_LINK]" },
                            "W2D4A7R": { title: "Next Steps Guide", type: "reading", link: "[READING_LINK]" }
                        }
                    }
                }
            },
            week3: {
                title: "Week 3: Integration & Assessment",
                collapsed: false,
                days: {
                    day1: {
                        title: "Day 1: Integration",
                        activities: {
                            "W3D1A1O": { title: "Integration Overview Video", type: "video", link: "[VIDEO_LINK]" },
                            "W3D1A2R": { title: "Integration Framework", type: "reading", link: "[READING_LINK]" },
                            "W3D1A3Q": { title: "Integration Quiz", type: "quiz", link: "[QUIZ_LINK]" },
                            "W3D1A4P": { title: "Integration Exercise", type: "practice", link: "[PRACTICE_LINK]" },
                            "W3D1A5A": { title: "Integration Project", type: "assignment", link: "[ASSIGNMENT_LINK]" },
                            "W3D1A6O": { title: "Case Study Video", type: "video", link: "[VIDEO_LINK]" },
                            "W3D1A7R": { title: "Integration Examples", type: "reading", link: "[READING_LINK]" }
                        }
                    },
                    day2: {
                        title: "Day 2: Assessment Preparation",
                        activities: {
                            "W3D2A1O": { title: "Assessment Prep Video", type: "video", link: "[VIDEO_LINK]" },
                            "W3D2A2R": { title: "Assessment Guidelines", type: "reading", link: "[READING_LINK]" },
                            "W3D2A3Q": { title: "Practice Assessment", type: "quiz", link: "[QUIZ_LINK]" },
                            "W3D2A4P": { title: "Mock Assessment", type: "practice", link: "[PRACTICE_LINK]" },
                            "W3D2A5A": { title: "Pre-Assessment Task", type: "assignment", link: "[ASSIGNMENT_LINK]" },
                            "W3D2A6O": { title: "Study Tips Video", type: "video", link: "[VIDEO_LINK]" },
                            "W3D2A7R": { title: "Review Materials", type: "reading", link: "[READING_LINK]" }
                        }
                    },
                    day3: {
                        title: "Day 3: Final Assessment",
                        activities: {
                            "W3D3A1O": { title: "Assessment Instructions Video", type: "video", link: "[VIDEO_LINK]" },
                            "W3D3A2R": { title: "Final Assessment Brief", type: "reading", link: "[READING_LINK]" },
                            "W3D3A3Q": { title: "Final Assessment Quiz", type: "quiz", link: "[QUIZ_LINK]" },
                            "W3D3A4P": { title: "Practical Assessment", type: "practice", link: "[PRACTICE_LINK]" },
                            "W3D3A5A": { title: "Capstone Project", type: "assignment", link: "[ASSIGNMENT_LINK]" },
                            "W3D3A6O": { title: "Submission Guide Video", type: "video", link: "[VIDEO_LINK]" },
                            "W3D3A7R": { title: "Assessment Rubric", type: "reading", link: "[READING_LINK]" }
                        }
                    },
                    day4: {
                        title: "Day 4: Completion & Next Steps",
                        activities: {
                            "W3D4A1O": { title: "Completion Ceremony Video", type: "video", link: "[VIDEO_LINK]" },
                            "W3D4A2R": { title: "Certificate Information", type: "reading", link: "[READING_LINK]" },
                            "W3D4A3Q": { title: "Feedback Survey", type: "quiz", link: "[QUIZ_LINK]" },
                            "W3D4A4P": { title: "Final Practice Session", type: "practice", link: "[PRACTICE_LINK]" },
                            "W3D4A5A": { title: "Course Evaluation", type: "assignment", link: "[ASSIGNMENT_LINK]" },
                            "W3D4A6O": { title: "Next Steps Video", type: "video", link: "[VIDEO_LINK]" },
                            "W3D4A7R": { title: "Continued Learning Resources", type: "reading", link: "[READING_LINK]" }
                        }
                    }
                }
            }
        };

        // Activity type icons and colors
        const activityConfig = {
            video: { icon: "🎥", color: "bg-blue-100 border-blue-300 text-blue-800", hoverColor: "hover:bg-blue-200" },
            reading: { icon: "📖", color: "bg-green-100 border-green-300 text-green-800", hoverColor: "hover:bg-green-200" },
            quiz: { icon: "📝", color: "bg-purple-100 border-purple-300 text-purple-800", hoverColor: "hover:bg-purple-200" },
            practice: { icon: "🛠️", color: "bg-orange-100 border-orange-300 text-orange-800", hoverColor: "hover:bg-orange-200" },
            assignment: { icon: "📋", color: "bg-red-100 border-red-300 text-red-800", hoverColor: "hover:bg-red-200" }
        };

        function DashboardApp() {
            const [studentName, setStudentName] = useState('');
            const [completedActivities, setCompletedActivities] = useState(new Set());
            const [progressLoaded, setProgressLoaded] = useState(false);
            const [saveStatus, setSaveStatus] = useState('');

            // Load progress on component mount and when name changes
            useEffect(() => {
                if (studentName.trim()) {
                    loadProgress(studentName.trim());
                }
            }, [studentName]);

            // Load saved progress from localStorage
            const loadProgress = (name) => {
                try {
                    const saved = localStorage.getItem(`dm-progress-${name}`);
                    if (saved) {
                        const data = JSON.parse(saved);
                        setCompletedActivities(new Set(data.completedActivities));
                        console.log('Progress loaded for', name, ':', data.completedActivities.length, 'activities');
                    }
                } catch (error) {
                    console.error('Error loading progress:', error);
                }
                setProgressLoaded(true);
            };

            // Save progress to both localStorage and Google Forms
            const saveProgress = (activityId, activityData, weekId, dayId) => {
                if (!studentName.trim()) return;
                
                setSaveStatus('saving');
                
                // Save to localStorage for persistence
                try {
                    const progressData = {
                        studentName: studentName.trim(),
                        completedActivities: Array.from(completedActivities),
                        lastUpdated: new Date().toISOString()
                    };
                    localStorage.setItem(`dm-progress-${studentName.trim()}`, JSON.stringify(progressData));
                } catch (error) {
                    console.error('Error saving to localStorage:', error);
                }

                // Calculate overall progress
                const totalActivities = 84; // 3 weeks × 4 days × 7 activities
                const overallProgress = Math.round((completedActivities.size / totalActivities) * 100);
                
                // Submit to Google Forms
                const formData = new FormData();
                formData.append('entry.115897476', studentName.trim());           // Student Name
                formData.append('entry.258074255', activityId);                   // Activity ID
                formData.append('entry.116182678', activityData.title);           // Activity Title
                formData.append('entry.152007192', activityData.type);            // Activity Type
                formData.append('entry.126225864', 'Day ' + dayId.replace('day', '')); // Day
                formData.append('entry.204814648', 'Week ' + weekId.replace('week', '')); // Week
                formData.append('entry.847575500', overallProgress + '%');        // Overall Progress

                fetch('https://docs.google.com/forms/d/e/1FAIpQLSesyqxfIPz5WAPV6HsPNKOfbUSH671bFE_1mI0fjGu1pjKkIA/formResponse', {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                })
                .then(() => {
                    console.log('✅ Save successful via Google Forms!');
                    setSaveStatus('success');
                    setTimeout(() => setSaveStatus(''), 2000);
                })
                .catch(error => {
                    console.error('❌ Save failed:', error);
                    setSaveStatus('error');
                    setTimeout(() => setSaveStatus(''), 3000);
                });
            };

            // Toggle activity completion
            const toggleActivity = (activityId, activityData, weekId, dayId) => {
                const newCompleted = new Set(completedActivities);
                
                if (newCompleted.has(activityId)) {
                    newCompleted.delete(activityId);
                } else {
                    newCompleted.add(activityId);
                    // Save progress when marking as complete
                    saveProgress(activityId, activityData, weekId, dayId);
                }
                
                setCompletedActivities(newCompleted);
            };

            // Toggle week collapse
            const toggleWeek = (weekId) => {
                activities[weekId].collapsed = !activities[weekId].collapsed;
                // Force re-render
                setCompletedActivities(new Set(completedActivities));
            };

            // Calculate progress
            const totalActivities = 84;
            const completedCount = completedActivities.size;
            const progressPercentage = totalActivities > 0 ? Math.round((completedCount / totalActivities) * 100) : 0;

            return (
                <div className="min-h-screen bg-gray-50 py-8">
                    {/* Save Status Indicator */}
                    {saveStatus && (
                        <div className={`save-status ${saveStatus}`}>
                            {saveStatus === 'saving' && '⏳ Saving...'}
                            {saveStatus === 'success' && '✅ Saved successfully!'}
                            {saveStatus === 'error' && '❌ Save failed'}
                        </div>
                    )}

                    <div className="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                        {/* Header */}
                        <div className="text-center mb-8">
                            <h1 className="text-4xl font-bold text-gray-900 mb-4">DM Teacher Dashboard</h1>
                            <p className="text-lg text-gray-600">Track your progress through the Direct Method course</p>
                        </div>

                        {/* Student Name Input */}
                        <div className="bg-white rounded-lg shadow-md p-6 mb-8">
                            <label htmlFor="studentName" className="block text-sm font-medium text-gray-700 mb-2">
                                Student Name
                            </label>
                            <input
                                type="text"
                                id="studentName"
                                value={studentName}
                                onChange={(e) => setStudentName(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="Enter your name to track progress"
                            />
                        </div>

                        {/* Progress Bar */}
                        {studentName && progressLoaded && (
                            <div className="bg-white rounded-lg shadow-md p-6 mb-8">
                                <div className="flex justify-between items-center mb-2">
                                    <h2 className="text-lg font-semibold text-gray-800">Overall Progress</h2>
                                    <span className="text-sm font-medium text-gray-600">
                                        {completedCount} of {totalActivities} activities completed
                                    </span>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-4">
                                    <div 
                                        className="progress-bar h-4 rounded-full" 
                                        style={{ width: `${progressPercentage}%` }}
                                    ></div>
                                </div>
                                <div className="text-center mt-2">
                                    <span className="text-2xl font-bold text-gray-800">{progressPercentage}%</span>
                                </div>
                            </div>
                        )}

                        {/* Activities by Week */}
                        {studentName && progressLoaded && (
                            <div className="space-y-8">
                                {Object.entries(activities).map(([weekId, week]) => (
                                    <div key={weekId} className="bg-white rounded-lg shadow-md overflow-hidden">
                                        {/* Week Header */}
                                        <div 
                                            className="week-header bg-gradient-to-r from-blue-600 to-blue-700 text-white p-6 flex justify-between items-center"
                                            onClick={() => toggleWeek(weekId)}
                                        >
                                            <h2 className="text-2xl font-bold">{week.title}</h2>
                                            <span className="text-2xl">
                                                {week.collapsed ? '▶️' : '▼'}
                                            </span>
                                        </div>

                                        {/* Week Content */}
                                        <div className={`week-content ${week.collapsed ? 'week-collapsed' : 'week-expanded'}`}>
                                            <div className="p-6">
                                                {Object.entries(week.days).map(([dayId, day]) => (
                                                    <div key={dayId} className="mb-8 last:mb-0">
                                                        <h3 className="text-xl font-semibold text-gray-800 mb-4 pb-2 border-b border-gray-200">
                                                            {day.title}
                                                        </h3>
                                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                                            {Object.entries(day.activities).map(([activityId, activity]) => {
                                                                const isCompleted = completedActivities.has(activityId);
                                                                const config = activityConfig[activity.type];
                                                                
                                                                return (
                                                                    <div
                                                                        key={activityId}
                                                                        className={`activity-item p-4 rounded-lg border-2 transition-all duration-200 ${
                                                                            isCompleted 
                                                                                ? 'completed border-green-500 bg-green-50' 
                                                                                : `${config.color} ${config.hoverColor} border-2`
                                                                        }`}
                                                                        onClick={() => toggleActivity(activityId, activityData, weekId, dayId)}
                                                                    >
                                                                        <div className="flex items-start justify-between">
                                                                            <div className="flex-1">
                                                                                <div className="flex items-center mb-2">
                                                                                    <span className="text-2xl mr-2">{config.icon}</span>
                                                                                    <span className="text-xs uppercase font-semibold tracking-wide">
                                                                                        {activity.type}
                                                                                    </span>
                                                                                </div>
                                                                                <h4 className="font-medium text-gray-900 mb-1">
                                                                                    {activity.title}
                                                                                </h4>
                                                                                <p className="text-xs text-gray-600">
                                                                                    ID: {activityId}
                                                                                </p>
                                                                            </div>
                                                                            <div className="ml-2">
                                                                                {isCompleted ? (
                                                                                    <span className="text-green-600 text-xl">✅</span>
                                                                                ) : (
                                                                                    <span className="text-gray-400 text-xl">⭕</span>
                                                                                )}
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                );
                                                            })}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Instructions */}
                        {!studentName && (
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                <h3 className="text-lg font-semibold text-blue-900 mb-2">Getting Started</h3>
                                <p className="text-blue-800">
                                    Enter your name above to begin tracking your progress through the Direct Method course. 
                                    Your progress will be automatically saved and submitted to track your learning journey.
                                </p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<DashboardApp />, document.getElementById('root'));
    </script>
</body>
</html>
